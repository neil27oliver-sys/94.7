<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>94.7 | Assessment</title>
  <style>
    :root {
      --royal-blue: #003087;
      --sky-blue: #00B4D8;
      --dark: #0f0f0f;
      --card: #1a1a1a;
      --text: #f0f4f8;
      --muted: #a0b0c0;
      --green: #00ff9d;
      --orange: #ff9500;
      --red: #ff4d4d;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--dark); color: var(--text); font-family: system-ui, sans-serif; line-height: 1.5; }
    nav {
      background: #000;
      padding: 1rem 2rem;
      display: flex;
      justify-content: center;
      gap: 2rem;
      border-bottom: 3px solid var(--sky-blue);
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap;
    }
    nav a {
      color: var(--muted);
      text-decoration: none;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.8px;
    }
    nav a.active, nav a:hover { color: var(--sky-blue); }

    main { max-width: 900px; margin: 2.5rem auto; padding: 0 1.5rem; }
    header { text-align: center; margin-bottom: 2.5rem; }
    h1 { color: var(--sky-blue); font-size: 2.4rem; margin-bottom: 0.4rem; }
    .subtitle { color: var(--muted); font-size: 1.05rem; }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 2rem;
      border-left: 5px solid var(--royal-blue);
      margin-bottom: 2rem;
    }
    .card h2 { color: var(--sky-blue); margin-bottom: 1.6rem; font-size: 1.7rem; }

    .field { margin-bottom: 1.5rem; }
    label { display: block; color: var(--muted); margin-bottom: 0.5rem; font-size: 0.95rem; }
    input {
      width: 100%;
      padding: 0.9rem 1rem;
      background: #111;
      border: 1px solid #333;
      color: white;
      border-radius: 6px;
      font-size: 1.05rem;
    }
    input:focus { outline: none; border-color: var(--sky-blue); box-shadow: 0 0 0 3px rgba(0,180,216,0.15); }

    .progress {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      font-weight: 500;
    }
    .progress.good { color: var(--green); }
    .progress.warning { color: var(--orange); }
    .progress.low { color: var(--red); }

    .estimate-box {
      background: rgba(0,180,216,0.15);
      padding: 1.8rem;
      border-radius: 12px;
      margin: 2rem 0;
      text-align: center;
      font-size: 1.7rem;
      font-weight: bold;
      border: 2px solid var(--sky-blue);
      color: var(--sky-blue);
    }

    .total-strength {
      text-align: center;
      margin: 2rem 0;
      font-size: 1.9rem;
      font-weight: bold;
      padding: 1.2rem;
      border-radius: 10px;
      background: rgba(0,0,0,0.3);
    }

    .btn {
      background: linear-gradient(90deg, var(--sky-blue), #0096c7);
      color: white;
      border: none;
      padding: 1.2rem 3rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      margin: 3rem auto;
      transition: all 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,180,216,0.4); }

    .notes {
      margin-top: 3rem;
      padding: 2rem;
      background: rgba(0,180,216,0.08);
      border-radius: 12px;
      border-left: 5px solid var(--sky-blue);
    }
    .notes h3 { color: var(--sky-blue); margin-bottom: 1rem; }
  </style>
</head>
<body>

<nav>
    <a href="index.html">Home</a>
  <a href="assesment.html" class="unlocked">Assessment</a>
        <a href="dashboard.html" class="unlocked">Dashboard</a>
        <a href="physical.html" class="unlocked">Physical</a>
        <a href="weight.html" class="unlocked">Bike/Weight</a>
        <a href="indoor.html" class="unlocked">Indoor</a>
        <a href="climbs.html" class="unlocked">Climbs</a>
        <a href="outdoor.html" class="unlocked">Outdoor</a>
        <a href="streching.html" class="unlocked">Stretching</a>
        <a href="mindset.html" class="unlocked">Mindset</a>
        
        
</nav>
<main>
  <header>
    <h1>Baseline Assessment</h1>
    <p class="subtitle">Enter current levels. Values update immediately. Re-test every 4 weeks to unlock certificates.</p>
  </header>

  <div class="card">
    <h2>1. Cycling Performance (3 Key Measures)</h2>

    <div class="field">
      <label>FTP Watts (20-min test × 0.95)</label>
      <input type="number" id="ftp" placeholder="e.g. 180" min="50">
      <div class="progress" id="ftpProg"></div>
    </div>

    <div class="field">
      <label>TSS (Training Stress Score – Less 50: Low stress – 50 to 80: Typical for a good 20-min FTP test – 80 to 150: Moderate – 150 to 300: High –  >300: Very high
)</label>
      <input type="number" id="tss" placeholder="e.g. 70" min="0">
    </div>

    <div class="field">
      <label>Intensity Factor (IF = NP / FTP)– 1.0 means you rode at your threshold FTP</label>
      <input type="number" step="0.01" id="if" placeholder="e.g. 0.95" min="0.5" max="1.5">
    </div>

    <div class="estimate-box">
      <div id="joburgTime">Ride Joburg (97 km ): —</div>
      <div id="capeTime" style="margin-top:0.8rem;">Cape Cycle Tour (109 km): —</div>
    </div>
  </div>

  <div class="card">
    <h2>2. Strength & Mobility (Triangle Radar Categories)</h2>

    <div class="field">
      <label>Push-Ups (max reps) – Strength</label>
      <input type="number" id="pushups" placeholder="e.g. 20" min="0">
      <div class="progress" id="pushupsProg"></div>
    </div>

    <div class="field">
      <label>Squats (max reps) – Strength</label>
      <input type="number" id="squats" placeholder="e.g. 30" min="0">
      <div class="progress" id="squatsProg"></div>
    </div>

    <div class="field">
      <label>Hip Flexor Stretch (seconds per side) – Flexibility</label>
      <input type="number" id="hipFlexor" placeholder="e.g. 60" min="0">
      <div class="progress" id="hipFlexorProg"></div>
    </div>

    <div class="field">
      <label>Hamstring Stretch (seconds) – Flexibility</label>
      <input type="number" id="hamstring" placeholder="e.g. 60" min="0">
      <div class="progress" id="hamstringProg"></div>
    </div>

    <div class="field">
      <label>Plank Hold (seconds) – Endurance</label>
      <input type="number" id="plank" placeholder="e.g. 60" min="0">
      <div class="progress" id="plankProg"></div>
    </div>

    <div class="total-strength" id="totalStrength">
      Strength & Mobility Overall: —
    </div>
  </div>

  <button class="btn" onclick="saveAssessment()">SAVE ASSESSMENT & GO TO DASHBOARD</button>

  <div class="notes">
    <h3>Measure Explanations</h3>
    <ul>
      <li><strong>FTP</strong>: Functional Threshold Power. Drives time estimates.</li>
      <li><strong>TSS</strong>: Overall load of a workout by combining its intensity and duration into one number, indicating the physiological stress on your body.</li>
      <li><strong>IF</strong>:  A key metric that shows how hard a workout was compared to your fitness level.</li>
      <li><strong>Strength & Mobility Radar</strong>: Live % toward Phase 3 targets.</li>
    </ul>
  </div>
</main>

<script>
const BENCHMARKS = {
  ftp: 240,
  pushups: 25,
  squats: 40,
  hipFlexor: 60,
  hamstring: 60,
  plank: 60
};

function updateBenchmark(id, value, benchmark) {
  const el = document.getElementById(id);
  if (!el) return;

  const pct = Math.min(100, Math.round((value / benchmark) * 100));
  let label = `${pct}%`;

  if (pct >= 75) label = `✓ ${pct}% (Unlocked)`;
  else if (pct >= 50) label = `${pct}% (Skill/Build)`;
  else label = `${pct}% (Foundation)`;

  el.textContent = label;
  el.className = 'progress ' + (pct >= 75 ? 'good' : pct >= 50 ? 'warning' : 'low');
}

function estimateTimes(ftp) {
  if (!ftp || ftp <= 0) return { joburg: '—', cape: '—' };

  // Lookup for the exact dashboard table values (solo times)
  if (Math.round(ftp) === 240) {
    return {
      joburg: '3h 25m',
      cape: '3h 55m'
    };
  }
  if (Math.round(ftp) === 200) {
    return {
      joburg: '3h 50m',
      cape: '4h 25m'
    };
  }
  if (Math.round(ftp) === 160) {
    return {
      joburg: '4h 35m',
      cape: '5h 15m'
    };
  }

  // Fallback: original formula for any other FTP value
  const racePower = ftp * 0.80;
  const baseSpeed = (racePower / 75) * 11.5;

  const joburgAdj = 0.95;
  const joburgHours = 97 / (baseSpeed * joburgAdj);

  const capeAdj = 0.92;
  const capeHours = 109 / (baseSpeed * capeAdj);

  const formatTime = (hrs) => {
    const h = Math.floor(hrs);
    const m = Math.round((hrs - h) * 60);
    return `${h}h ${m}m`;
  };

  return {
    joburg: formatTime(joburgHours),
    cape: formatTime(capeHours)
  };
}

function updateAll() {
  const data = {
    ftp: +document.getElementById('ftp').value || 0,
    tss: +document.getElementById('tss').value || 0,
    if: +document.getElementById('if').value || 0,
    pushups: +document.getElementById('pushups').value || 0,
    squats: +document.getElementById('squats').value || 0,
    hipFlexor: +document.getElementById('hipFlexor').value || 0,
    hamstring: +document.getElementById('hamstring').value || 0,
    plank: +document.getElementById('plank').value || 0
  };

  // Update individual progress labels
  updateBenchmark('ftpProg', data.ftp, BENCHMARKS.ftp);
  updateBenchmark('pushupsProg', data.pushups, BENCHMARKS.pushups);
  updateBenchmark('squatsProg', data.squats, BENCHMARKS.squats);
  updateBenchmark('hipFlexorProg', data.hipFlexor, BENCHMARKS.hipFlexor);
  updateBenchmark('hamstringProg', data.hamstring, BENCHMARKS.hamstring);
  updateBenchmark('plankProg', data.plank, BENCHMARKS.plank);

  // Update Race Estimates
  const times = estimateTimes(data.ftp);
  document.getElementById('joburgTime').innerHTML = `Ride Joburg (97 km): <span>${times.joburg}</span>`;
  document.getElementById('capeTime').innerHTML = `Cape Cycle Tour (109 km): <span>${times.cape}</span>`;

  // Overall Strength Calculation
  let categories = 0;
  let totalPct = 0;

  // Strength
  if (data.pushups || data.squats) {
    const p = ((data.pushups/BENCHMARKS.pushups) + (data.squats/BENCHMARKS.squats)) / 2;
    totalPct += p;
    categories++;
  }
  // Flex
  if (data.hipFlexor || data.hamstring) {
    const f = ((data.hipFlexor/BENCHMARKS.hipFlexor) + (data.hamstring/BENCHMARKS.hamstring)) / 2;
    totalPct += f;
    categories++;
  }
  // Endurance
  if (data.plank) {
    totalPct += (data.plank / BENCHMARKS.plank);
    categories++;
  }

  const avgPct = categories > 0 ? Math.min(100, Math.round((totalPct / categories) * 100)) : 0;
  const totalEl = document.getElementById('totalStrength');
  
  totalEl.textContent = `Strength & Mobility Overall: ${avgPct}%`;
  
  // Color logic
  if (avgPct >= 75) {
    totalEl.style.color = '#00ff9d';
    totalEl.style.background = 'rgba(0,255,157,0.1)';
  } else if (avgPct >= 50) {
    totalEl.style.color = '#ff9500';
    totalEl.style.background = 'rgba(255,149,0,0.1)';
  } else {
    totalEl.style.color = '#ff4d4d';
    totalEl.style.background = 'rgba(255,77,77,0.1)';
  }
}

// Updated save function – now includes TSS and IF for the new radar
function saveAssessment() {
  const data = {
    ftp: +document.getElementById('ftp')?.value || 0,
    tss: +document.getElementById('tss')?.value || 0,
    if: +document.getElementById('if')?.value || 0,
    pushups: +document.getElementById('pushups')?.value || 0,
    squats: +document.getElementById('squats')?.value || 0,
    hipFlexor: +document.getElementById('hipFlexor')?.value || 0,
    hamstring: +document.getElementById('hamstring')?.value || 0,
    plank: +document.getElementById('plank')?.value || 0,
    timestamp: new Date().toLocaleString()
  };

  // Save to History
  let history = JSON.parse(localStorage.getItem('assessmentHistory') || '[]');
  history.push(data);
  localStorage.setItem('assessmentHistory', JSON.stringify(history));

  // Save as latest for quick access
  localStorage.setItem('lastAssessment', JSON.stringify(data));

  alert('Assessment saved! Dashboard now updated with Cycling Performance data.');
  window.location.href = 'dashboard.html'; // Auto-redirect to see the radars update
}

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', updateAll);
  });
  updateAll();
});
</script>